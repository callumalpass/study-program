# OSPF: Open Shortest Path First

## Introduction to OSPF

OSPF (Open Shortest Path First) is the most widely deployed interior gateway protocol for enterprise networks. Defined in RFC 2328 (OSPFv2 for IPv4) and RFC 5340 (OSPFv3 for IPv6), OSPF is an open standard link state protocol that provides fast convergence, hierarchical design, and support for large networks.

OSPF was developed to overcome limitations of distance vector protocols like RIP, particularly the slow convergence and hop count limitations that made RIP unsuitable for large networks.

## OSPF Characteristics

**Link State Protocol**: Every router has a complete topology map and independently computes routes using Dijkstra's algorithm.

**Hierarchical Design**: Networks are divided into areas to reduce routing overhead and enable summarization.

**Fast Convergence**: Changes trigger immediate updates rather than periodic broadcasts. Typical convergence is subsecond.

**Classless**: Full support for VLSM and CIDR.

**Equal-Cost Multi-Path (ECMP)**: Load balances across multiple equal-cost paths.

**Authentication**: Supports plaintext, MD5, and SHA authentication.

## OSPF Areas

OSPF divides large networks into areas to improve scalability:

**Area 0 (Backbone)**: The central area that all other areas must connect to. Carries inter-area traffic.

**Regular Areas**: Connected to the backbone. Contain detailed topology of their own networks.

**Stub Areas**: Don't receive external routes; use default route instead. Reduces routing table size.

**Totally Stubby Areas**: Don't receive external or inter-area routes. Even smaller routing tables.

**NSSA (Not-So-Stubby Area)**: Stub area that can inject limited external routes.

```
        [Area 1]----[Area 0]----[Area 2]
             \        |        /
              \    Backbone   /
               \     |      /
                [Area 3 (Stub)]
```

## OSPF Router Types

**Internal Router**: All interfaces in single area.

**Backbone Router**: At least one interface in Area 0.

**Area Border Router (ABR)**: Connects two or more areas. Maintains separate LSDB for each area.

**AS Boundary Router (ASBR)**: Connects OSPF to other routing domains. Redistributes external routes.

## OSPF Packet Types

**Hello (Type 1)**: Discovers neighbors, establishes adjacencies, acts as keepalive.

**Database Description (Type 2)**: Summarizes LSDB contents during adjacency formation.

**Link State Request (Type 3)**: Requests specific LSAs from neighbor.

**Link State Update (Type 4)**: Contains LSAs being flooded.

**Link State Acknowledgment (Type 5)**: Confirms receipt of LSAs.

## Neighbor Discovery and Adjacency

OSPF routers become neighbors through Hello packets:

1. **Down**: No Hello received
2. **Init**: Hello received, but own router not listed
3. **2-Way**: Mutual Hello exchange, neighbor relationship formed
4. **ExStart**: Master/slave negotiation for DB exchange
5. **Exchange**: Database Description packets exchanged
6. **Loading**: Link State Requests sent for missing LSAs
7. **Full**: LSDBs synchronized, adjacency complete

Not all neighbors become adjacent. On broadcast networks, only the Designated Router (DR) and Backup Designated Router (BDR) form adjacencies with all routers.

## Designated Router Election

On broadcast networks (Ethernet), electing a DR reduces the number of adjacencies:

**Without DR**: n routers = n(n-1)/2 adjacencies
**With DR**: n routers = n-1 adjacencies (all to DR)

**Election criteria**:
1. Highest OSPF priority (configurable, 0-255, default 1)
2. If tie, highest Router ID
3. Priority 0 = never become DR

DR and BDR are elected per network segment. The BDR takes over if DR fails.

## OSPF Metric (Cost)

OSPF uses cost as its metric:

```
Cost = Reference Bandwidth / Interface Bandwidth
```

Default reference bandwidth: 100 Mbps

| Interface | Cost |
|-----------|------|
| 10 Mbps | 10 |
| 100 Mbps | 1 |
| 1 Gbps | 1 |
| 10 Gbps | 1 |

Problem: All fast interfaces have cost 1. Solution: Increase reference bandwidth.

```
router ospf 1
  auto-cost reference-bandwidth 10000  ! 10 Gbps
```

Now: 1 Gbps = 10, 10 Gbps = 1

## LSA Types

**Type 1 (Router LSA)**: Describes router's links within an area. Flooded within area only.

**Type 2 (Network LSA)**: Generated by DR for broadcast networks. Lists all routers on segment.

**Type 3 (Summary LSA)**: Generated by ABR. Advertises inter-area routes.

**Type 4 (ASBR Summary)**: Generated by ABR. Describes how to reach ASBR.

**Type 5 (External LSA)**: Generated by ASBR. Describes external routes. Flooded throughout AS.

**Type 7 (NSSA External)**: External routes in NSSA areas. Converted to Type 5 at ABR.

## OSPF Configuration Example

```
router ospf 1
  router-id 1.1.1.1
  network 10.0.0.0 0.255.255.255 area 0
  network 192.168.1.0 0.0.0.255 area 1
  passive-interface GigabitEthernet0/1

interface GigabitEthernet0/0
  ip ospf cost 10
  ip ospf priority 100
```

OSPF is the standard choice for enterprise interior routing, providing the scalability and fast convergence that modern networks require.
